<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard de Gestão | Tema Escuro</title>
    
    <!-- Google Fonts: Poppins -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Font Awesome para Ícones -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" xintegrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />

    <style>
        /* --- RESET E VARIÁVEIS GLOBAIS (TEMA ESCURO) --- */
        :root {
            --cor-primaria: #007bff;
            --cor-fundo-principal: #121212;
            --cor-fundo-secundario: #1e1e1e;
            --cor-container: #2a2a2a;
            --cor-texto-principal: #e0e0e0;
            --cor-texto-secundario: #a0a0a0;
            --cor-borda: #444;
            --cor-perigo: #e53935;
            --sombra-caixa: 0 6px 20px rgba(0, 0, 0, 0.25);
            --border-radius: 10px;
            font-family: 'Poppins', sans-serif;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background-color: var(--cor-fundo-principal);
            color: var(--cor-texto-principal);
            line-height: 1.6;
            font-size: 16px;
        }

        .container-principal {
            display: flex;
            min-height: 100vh;
        }
        
        /* --- MODAL DE CONFIRMAÇÃO --- */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s, visibility 0.3s;
        }

        .modal-overlay.visible {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background: var(--cor-container);
            padding: 2rem;
            border-radius: var(--border-radius);
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            text-align: center;
            max-width: 400px;
            width: 90%;
            border-top: 4px solid var(--cor-primaria);
            transform: translateY(20px);
            transition: transform 0.3s, opacity 0.3s;
        }
        
        .modal-overlay.visible .modal-content {
            transform: translateY(0);
            opacity: 1;
        }

        .modal-content h3 {
            margin-bottom: 1rem;
            color: var(--cor-texto-principal);
            font-weight: 600;
        }
        
        .modal-content p {
            margin-bottom: 2rem;
            color: var(--cor-texto-secundario);
        }

        .modal-actions {
            display: flex;
            justify-content: center;
            gap: 1rem;
        }

        .modal-btn {
            padding: 0.7rem 1.4rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-family: 'Poppins', sans-serif;
            transition: all 0.2s ease-in-out;
        }
        
        .modal-btn:hover {
            transform: translateY(-2px);
        }

        #modal-confirm-btn {
            background-color: var(--cor-perigo);
            color: white;
        }
        #modal-confirm-btn:hover {
             box-shadow: 0 4px 15px rgba(229, 57, 53, 0.4);
        }

        #modal-cancel-btn {
            background-color: #444;
            color: var(--cor-texto-principal);
        }
        #modal-cancel-btn:hover {
            background-color: #555;
        }

        /* --- SIDEBAR (FORMULÁRIO DE CADASTRO) --- */
        .sidebar {
            width: 340px;
            background-color: var(--cor-fundo-secundario);
            padding: 2rem;
            border-right: 1px solid var(--cor-borda);
            display: flex;
            flex-direction: column;
        }

        .sidebar-header {
            margin-bottom: 2.5rem;
            text-align: center;
        }

        .sidebar-header h2 {
            color: var(--cor-primaria);
            font-weight: 700;
            font-size: 2rem;
            letter-spacing: 1px;
        }

        #form-cadastro h3 {
            margin-bottom: 1.5rem;
            font-weight: 600;
            font-size: 1.2rem;
            color: var(--cor-texto-principal);
            border-left: 3px solid var(--cor-primaria);
            padding-left: 1rem;
        }

        .form-group {
            margin-bottom: 1.25rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            font-size: 0.9rem;
            color: var(--cor-texto-secundario);
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 0.8rem;
            border: 1px solid var(--cor-borda);
            background-color: var(--cor-fundo-secundario);
            color: var(--cor-texto-principal);
            border-radius: 8px;
            font-size: 1rem;
            font-family: 'Poppins', sans-serif;
            transition: border-color 0.3s, box-shadow 0.3s;
        }
        
        .form-group select option {
            background: var(--cor-fundo-secundario);
            color: var(--cor-texto-principal);
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: var(--cor-primaria);
            box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.25);
        }

        .btn {
            width: 100%;
            padding: 0.9rem;
            border: none;
            border-radius: 8px;
            font-size: 1.05rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 0.75rem;
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }

        .btn-cadastrar {
            background-color: var(--cor-primaria);
            color: white;
        }
        .btn-cadastrar:hover {
             box-shadow: 0 4px 20px rgba(0, 123, 255, 0.4);
        }

        .admin-actions {
            margin-top: auto;
            padding-top: 1.5rem;
            border-top: 1px solid var(--cor-borda);
        }

        .btn-perigo {
            background-color: transparent;
            color: var(--cor-perigo);
            border: 1px solid var(--cor-perigo);
        }
        .btn-perigo:hover {
            background-color: var(--cor-perigo);
            color: white;
        }

        /* --- CONTEÚDO PRINCIPAL --- */
        .main-content {
            flex-grow: 1;
            padding: 2.5rem;
            overflow-y: auto;
        }

        .main-header {
            margin-bottom: 2rem;
        }
        
        .main-header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }
        
        .main-header p {
            color: var(--cor-texto-secundario);
            font-size: 1.1rem;
        }

        /* --- CARDS DO DASHBOARD --- */
        .dashboard-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2.5rem;
        }

        .card {
            background: linear-gradient(145deg, #2e2e2e, #242424);
            padding: 1.5rem;
            border-radius: var(--border-radius);
            box-shadow: var(--sombra-caixa);
            position: relative;
            overflow: hidden;
            transition: transform 0.3s, box-shadow 0.3s;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        }

        .card .card-icon {
            font-size: 1.8rem;
            margin-bottom: 1rem;
            color: var(--cor-primaria);
            width: 50px;
            height: 50px;
            background-color: rgba(0, 123, 255, 0.1);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .card.total .card-icon { color: #9575cd; background-color: rgba(149, 117, 205, 0.1); }
        .card.comercial .card-icon { color: #4caf50; background-color: rgba(76, 175, 80, 0.1); }
        .card.producao .card-icon { color: #ffc107; background-color: rgba(255, 193, 7, 0.1); }
        .card.quebragem .card-icon { color: #fd7e14; background-color: rgba(253, 126, 20, 0.1); }
        .card.qualidade .card-icon { color: #20c997; background-color: rgba(32, 201, 151, 0.1); }
        .card.manutencao .card-icon { color: #6c757d; background-color: rgba(108, 117, 125, 0.1); }


        .card-info p {
            color: var(--cor-texto-secundario);
            font-weight: 500;
            font-size: 0.95rem;
            margin-bottom: 0.25rem;
        }

        .card-info h3 {
            font-size: 2.8rem;
            font-weight: 700;
            line-height: 1;
            color: var(--cor-texto-principal);
        }

        /* --- LISTA DE FUNCIONÁRIOS --- */
        .employee-list-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
            gap: 1rem;
        }
        
        .employee-list-header h2 {
            font-size: 1.5rem;
        }
        
        .search-container {
            position: relative;
            width: 350px;
        }
        
        #busca {
            width: 100%;
            padding: 0.8rem;
            padding-left: 2.5rem;
            border-radius: 8px;
            border: 1px solid var(--cor-borda);
            background-color: var(--cor-container);
            color: var(--cor-texto-principal);
            font-family: 'Poppins', sans-serif;
        }
        
        .search-container i {
            position: absolute;
            left: 0.9rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--cor-texto-secundario);
        }

        .table-wrapper {
            background-color: var(--cor-fundo-secundario);
            border-radius: var(--border-radius);
            box-shadow: var(--sombra-caixa);
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 600px;
        }

        th, td {
            padding: 1.25rem;
            text-align: left;
            border-bottom: 1px solid var(--cor-borda);
        }

        thead th {
            font-weight: 600;
            color: var(--cor-texto-secundario);
            text-transform: uppercase;
            font-size: 0.8rem;
            letter-spacing: 0.5px;
        }
        
        tbody tr {
            transition: background-color 0.2s;
        }

        tbody tr:last-child td {
            border-bottom: none;
        }

        tbody tr:hover {
            background-color: var(--cor-container);
        }
        
        .setor-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 15px;
            font-weight: 500;
            font-size: 0.85rem;
            color: #fff;
        }
        
        .setor-administrativo { background-color: #007bff; }
        .setor-comercial { background-color: #4caf50; }
        .setor-producao { background-color: #ffc107; color: #121212; }
        .setor-quebragem { background-color: #fd7e14; }
        .setor-qualidade { background-color: #20c997; }
        .setor-manutencao { background-color: #6c757d; }

        .btn-excluir {
            background: none;
            border: none;
            color: var(--cor-texto-secundario);
            cursor: pointer;
            font-size: 1.2rem;
            transition: color 0.3s;
        }

        .btn-excluir:hover {
            color: var(--cor-perigo);
        }
        
        #lista-funcionarios .empty-row td {
            text-align: center;
            padding: 3rem;
            color: var(--cor-texto-secundario);
            font-style: italic;
        }

        /* --- RESPONSIVIDADE --- */
        @media (max-width: 1200px) {
            .container-principal {
                flex-direction: column;
            }
            .sidebar {
                width: 100%;
                height: auto;
                border-right: none;
                border-bottom: 1px solid var(--cor-borda);
            }
        }
        
        @media (max-width: 768px) {
            .main-content {
                padding: 1.5rem;
            }
            .search-container {
                width: 100%;
            }
            .dashboard-cards {
                grid-template-columns: 1fr 1fr;
            }
        }

        @media (max-width: 576px) {
            .dashboard-cards {
                grid-template-columns: 1fr;
            }
            .sidebar, .main-content {
                padding: 1rem;
            }
            .main-header h1 {
                font-size: 2rem;
            }
             .employee-list-header {
                flex-direction: column;
                align-items: flex-start;
            }
        }
    </style>
</head>
<body>

    <div class="container-principal">
        <!-- Sidebar para Cadastro -->
        <aside class="sidebar">
            <header class="sidebar-header">
                <h2>GestãoPro</h2>
            </header>
            
            <form id="form-cadastro">
                <h3>Novo Colaborador</h3>
                <div class="form-group">
                    <label for="nome">Nome Completo</label>
                    <input type="text" id="nome" required placeholder="Ex: Carlos Andrade">
                </div>
                <div class="form-group">
                    <label for="funcao">Função (Cargo)</label>
                    <input type="text" id="funcao" required placeholder="Ex: Engenheiro de Produção">
                </div>
                <div class="form-group">
                    <label for="setor">Setor</label>
                    <select id="setor" required>
                        <option value="" disabled selected>Selecione um setor</option>
                        <option value="Administrativo">Administrativo</option>
                        <option value="Comercial">Comercial</option>
                        <option value="Produção">Produção</option>
                        <option value="Quebragem">Quebragem</option>
                        <option value="Qualidade">Qualidade</option>
                        <option value="Manutenção">Manutenção</option>
                    </select>
                </div>
                <button type="submit" class="btn btn-cadastrar">
                    <i class="fas fa-plus-circle"></i> Adicionar
                </button>
            </form>

            <div class="admin-actions">
                <button id="btn-limpar-tudo" class="btn btn-perigo">
                    <i class="fas fa-exclamation-triangle"></i> Limpar Tudo
                </button>
            </div>
        </aside>

        <!-- Conteúdo Principal do Dashboard -->
        <main class="main-content">
            <header class="main-header">
                <h1>Visão Geral</h1>
                <p>Acompanhe os indicadores e a equipe em tempo real.</p>
            </header>

            <!-- Cards de Resumo -->
            <section class="dashboard-cards">
                <div class="card total">
                    <div class="card-icon"><i class="fas fa-users"></i></div>
                    <div class="card-info">
                        <p>Total de Colaboradores</p>
                        <h3 id="total-funcionarios">0</h3>
                    </div>
                </div>
                <div class="card administrativo">
                    <div class="card-icon"><i class="fas fa-briefcase"></i></div>
                    <div class="card-info">
                        <p>Administrativo</p>
                        <h3 id="total-administrativo">0</h3>
                    </div>
                </div>
                <div class="card comercial">
                     <div class="card-icon"><i class="fas fa-chart-line"></i></div>
                    <div class="card-info">
                        <p>Comercial</p>
                        <h3 id="total-comercial">0</h3>
                    </div>
                </div>
                 <div class="card producao">
                     <div class="card-icon"><i class="fas fa-cogs"></i></div>
                    <div class="card-info">
                        <p>Produção</p>
                        <h3 id="total-producao">0</h3>
                    </div>
                </div>
                <div class="card quebragem">
                     <div class="card-icon"><i class="fas fa-hammer"></i></div>
                    <div class="card-info">
                        <p>Quebragem</p>
                        <h3 id="total-quebragem">0</h3>
                    </div>
                </div>
                <div class="card qualidade">
                     <div class="card-icon"><i class="fas fa-check-circle"></i></div>
                    <div class="card-info">
                        <p>Qualidade</p>
                        <h3 id="total-qualidade">0</h3>
                    </div>
                </div>
                <div class="card manutencao">
                     <div class="card-icon"><i class="fas fa-tools"></i></div>
                    <div class="card-info">
                        <p>Manutenção</p>
                        <h3 id="total-manutencao">0</h3>
                    </div>
                </div>
            </section>

            <!-- Lista de Funcionários -->
            <section class="employee-list">
                <div class="employee-list-header">
                    <h2>Equipe</h2>
                    <div class="search-container">
                        <i class="fas fa-search"></i>
                        <input type="text" id="busca" placeholder="Buscar por nome, função ou setor...">
                    </div>
                </div>
                <div class="table-wrapper">
                    <table>
                        <thead>
                            <tr>
                                <th>Nome Completo</th>
                                <th>Função</th>
                                <th>Setor</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody id="lista-funcionarios">
                            <!-- Linhas serão inseridas dinamicamente pelo JavaScript -->
                        </tbody>
                    </table>
                </div>
            </section>
        </main>
    </div>
    
    <!-- Modal de Confirmação -->
    <div class="modal-overlay" id="confirmation-modal">
        <div class="modal-content">
            <h3 id="modal-title">Confirmar Ação</h3>
            <p id="modal-message">Você tem certeza?</p>
            <div class="modal-actions">
                <button id="modal-cancel-btn" class="modal-btn">Cancelar</button>
                <button id="modal-confirm-btn" class="modal-btn">Confirmar</button>
            </div>
        </div>
    </div>

    <!-- SDKs do Firebase (versão modular) -->
    <script type="module">
        // Importe as funções que você precisa dos SDKs
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getFirestore, collection, addDoc, onSnapshot, doc, deleteDoc, getDocs, writeBatch } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

        // =================================================================================
        // ATENÇÃO: Substitua o objeto abaixo pela configuração do seu projeto Firebase
        // =================================================================================
        const firebaseConfig = {
            apiKey: "COLE_SUA_API_KEY_AQUI",
            authDomain: "SEU_PROJETO.firebaseapp.com",
            projectId: "SEU_PROJECT_ID",
            storageBucket: "SEU_PROJETO.appspot.com",
            messagingSenderId: "SEU_MESSAGING_SENDER_ID",
            appId: "SEU_APP_ID"
        };

        // --- INICIALIZAÇÃO DO FIREBASE ---
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const funcionariosCollection = collection(db, 'funcionarios');

        // --- SELETORES DO DOM ---
        const formCadastro = document.getElementById('form-cadastro');
        const listaFuncionariosTbody = document.getElementById('lista-funcionarios');
        const buscaInput = document.getElementById('busca');
        const btnLimparTudo = document.getElementById('btn-limpar-tudo');
        
        const contadoresEl = {
            total: document.getElementById('total-funcionarios'),
            administrativo: document.getElementById('total-administrativo'),
            comercial: document.getElementById('total-comercial'),
            producao: document.getElementById('total-producao'),
            quebragem: document.getElementById('total-quebragem'),
            qualidade: document.getElementById('total-qualidade'),
            manutencao: document.getElementById('total-manutencao')
        };
        
        const modal = document.getElementById('confirmation-modal');
        const modalTitle = document.getElementById('modal-title');
        const modalMessage = document.getElementById('modal-message');
        const modalConfirmBtn = document.getElementById('modal-confirm-btn');
        const modalCancelBtn = document.getElementById('modal-cancel-btn');


        let funcionariosCache = []; 
        let resolvePromise = null;

        // --- FUNÇÕES DO MODAL ---
        function showConfirmationModal(title, message) {
            modalTitle.textContent = title;
            modalMessage.textContent = message;
            modal.classList.add('visible');
            
            return new Promise((resolve) => {
                resolvePromise = resolve;
            });
        }

        function closeModal(resolution) {
            if (resolvePromise) resolvePromise(resolution);
            modal.classList.remove('visible');
        }

        modalConfirmBtn.addEventListener('click', () => closeModal(true));
        modalCancelBtn.addEventListener('click', () => closeModal(false));
        modal.addEventListener('click', (e) => {
            if (e.target === modal) closeModal(false);
        });

        // --- FUNÇÕES PRINCIPAIS ---
        function animateCount(el, endValue) {
            const startValue = parseInt(el.textContent, 10) || 0;
            if (startValue === endValue) return;
            
            const duration = 1000;
            let startTime = null;

            function animation(currentTime) {
                if (!startTime) startTime = currentTime;
                const progress = Math.min((currentTime - startTime) / duration, 1);
                const currentValue = Math.floor(progress * (endValue - startValue) + startValue);
                el.textContent = currentValue;
                if (progress < 1) {
                    requestAnimationFrame(animation);
                }
            }
            requestAnimationFrame(animation);
        }

        const renderizarDashboard = (funcionarios) => {
            listaFuncionariosTbody.innerHTML = '';
            const contadoresSetor = {
                Administrativo: 0, Comercial: 0, Produção: 0, 
                Quebragem: 0, Qualidade: 0, Manutenção: 0
            };

            if (funcionarios.length === 0) {
                listaFuncionariosTbody.innerHTML = '<tr class="empty-row"><td colspan="4">Nenhum colaborador cadastrado.</td></tr>';
            } else {
                funcionarios.forEach(func => {
                    const setorClass = func.setor.toLowerCase().replace('ç', 'c').replace('ã', 'a');
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td>${func.nome}</td>
                        <td>${func.funcao}</td>
                        <td><span class="setor-badge setor-${setorClass}">${func.setor}</span></td>
                        <td>
                            <button class="btn-excluir" data-id="${func.id}" title="Excluir colaborador">
                                <i class="fas fa-trash-alt"></i>
                            </button>
                        </td>
                    `;
                    listaFuncionariosTbody.appendChild(tr);

                    if (contadoresSetor.hasOwnProperty(func.setor)) {
                        contadoresSetor[func.setor]++;
                    }
                });
            }

            animateCount(contadoresEl.total, funcionarios.length);
            animateCount(contadoresEl.administrativo, contadoresSetor.Administrativo);
            animateCount(contadoresEl.comercial, contadoresSetor.Comercial);
            animateCount(contadoresEl.producao, contadoresSetor.Produção);
            animateCount(contadoresEl.quebragem, contadoresSetor.Quebragem);
            animateCount(contadoresEl.qualidade, contadoresSetor.Qualidade);
            animateCount(contadoresEl.manutencao, contadoresSetor.Manutenção);
        };

        const filtrarErenderizar = () => {
            const termoBusca = buscaInput.value.toLowerCase().trim();
            
            if (!termoBusca) {
                renderizarDashboard(funcionariosCache);
                return;
            }

            const funcionariosFiltrados = funcionariosCache.filter(func => 
                func.nome.toLowerCase().includes(termoBusca) || 
                func.funcao.toLowerCase().includes(termoBusca) ||
                func.setor.toLowerCase().includes(termoBusca)
            );
            renderizarDashboard(funcionariosFiltrados);
        };

        // --- EVENT LISTENERS ---
        formCadastro.addEventListener('submit', async (e) => {
            e.preventDefault();
            const { nome, funcao, setor } = formCadastro.elements;

            if (!nome.value || !funcao.value || !setor.value) {
                alert('Por favor, preencha todos os campos!');
                return;
            }

            try {
                await addDoc(funcionariosCollection, {
                    nome: nome.value.trim(),
                    funcao: funcao.value.trim(),
                    setor: setor.value,
                    dataCadastro: new Date().toISOString()
                });
                formCadastro.reset();
                nome.focus();
            } catch (error) {
                console.error("Erro ao cadastrar funcionário: ", error);
                alert("Ocorreu um erro ao cadastrar. Tente novamente.");
            }
        });

        listaFuncionariosTbody.addEventListener('click', async (e) => {
            const button = e.target.closest('.btn-excluir');
            if (button) {
                const id = button.dataset.id;
                const nomeFuncionario = button.closest('tr').cells[0].textContent;
                
                const confirmado = await showConfirmationModal(
                    'Excluir Colaborador', 
                    `Tem certeza que deseja remover "${nomeFuncionario}" da equipe?`
                );

                if (confirmado) {
                    try {
                        await deleteDoc(doc(db, 'funcionarios', id));
                    } catch (error) {
                        console.error("Erro ao excluir funcionário: ", error);
                        alert("Ocorreu um erro ao excluir. Tente novamente.");
                    }
                }
            }
        });

        buscaInput.addEventListener('input', filtrarErenderizar);

        btnLimparTudo.addEventListener('click', async () => {
            const confirmado = await showConfirmationModal(
                'Limpar Todos os Dados', 
                'ATENÇÃO! Esta ação é irreversível e excluirá TODOS os registros de colaboradores. Deseja continuar?'
            );

            if (confirmado) {
                try {
                    const querySnapshot = await getDocs(funcionariosCollection);
                    if (querySnapshot.empty) return;
                    
                    const batch = writeBatch(db);
                    querySnapshot.forEach(doc => batch.delete(doc.ref));
                    await batch.commit();

                } catch (error) {
                     console.error("Erro ao limpar a coleção: ", error);
                     alert("Ocorreu um erro ao limpar os dados.");
                }
            }
        });

        // --- LISTENER EM TEMPO REAL DO FIRESTORE ---
        onSnapshot(funcionariosCollection, (snapshot) => {
            funcionariosCache = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
            funcionariosCache.sort((a, b) => a.nome.localeCompare(b.nome)); 
            filtrarErenderizar();
        });

    </script>
</body>
</html>
